#include "renderer.hpp"

#include <stddef.h>
#include <stdint.h>

#include "../efi/gop.hpp"

namespace {
EFI_GRAPHICS_OUTPUT_PROTOCOL* g_gop = nullptr;

// Simple 8x16 bitmap font for ASCII 32..127.
static const uint8_t kFont8x16[96][16] = {
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // ' '
    {0x18, 0x3c, 0x3c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00},  // '!'
    {0x36, 0x36, 0x36, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '"'
    {0x36, 0x36, 0x36, 0x7f, 0x36, 0x36, 0x36, 0x7f, 0x36, 0x36, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00},  // '#'
    {0x0c, 0x0c, 0x3f, 0x61, 0x60, 0x60, 0x3e, 0x03, 0x03, 0x43, 0x3f, 0x0c, 0x0c, 0x00, 0x00, 0x00},  // '$'
    {0x00, 0x00, 0x63, 0x63, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc6, 0xc6, 0x00, 0x00, 0x00, 0x00, 0x00},  // '%'
    {0x1c, 0x36, 0x36, 0x36, 0x1c, 0x18, 0x3b, 0x6e, 0x66, 0x66, 0x3b, 0x00, 0x00, 0x00, 0x00, 0x00},  // '&'
    {0x18, 0x18, 0x18, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '''
    {0x0c, 0x18, 0x30, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x30, 0x18, 0x0c, 0x00, 0x00, 0x00, 0x00},  // '('
    {0x30, 0x18, 0x0c, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x0c, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00},  // ')'
    {0x00, 0x00, 0x00, 0x36, 0x1c, 0x7f, 0x1c, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '*'
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x7e, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '+'
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x10, 0x00, 0x00},  // ','
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '-'
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00},  // '.'
    {0x00, 0x03, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '/'
    {0x3e, 0x63, 0x67, 0x6f, 0x7f, 0x7b, 0x73, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '0'
    {0x0c, 0x1c, 0x3c, 0x6c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00},  // '1'
    {0x3e, 0x63, 0x63, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x63, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00},  // '2'
    {0x3e, 0x63, 0x63, 0x03, 0x06, 0x1c, 0x06, 0x03, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '3'
    {0x06, 0x0e, 0x1e, 0x36, 0x66, 0x46, 0x7f, 0x06, 0x06, 0x06, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00},  // '4'
    {0x7f, 0x60, 0x60, 0x7e, 0x63, 0x03, 0x03, 0x03, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '5'
    {0x1e, 0x30, 0x60, 0x60, 0x7e, 0x63, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '6'
    {0x7f, 0x63, 0x63, 0x03, 0x06, 0x0c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},  // '7'
    {0x3e, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '8'
    {0x3e, 0x63, 0x63, 0x63, 0x63, 0x3f, 0x03, 0x03, 0x06, 0x0c, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00},  // '9'
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00},  // ':'
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x10, 0x00, 0x00, 0x00},  // ';'
    {0x00, 0x00, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00},  // '<'
    {0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '='
    {0x00, 0x00, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00},  // '>'
    {0x3e, 0x63, 0x63, 0x03, 0x06, 0x0c, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},  // '?'
    {0x3e, 0x63, 0x63, 0x03, 0x3b, 0x7b, 0x7b, 0x7b, 0x7b, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '@'
    {0x1c, 0x36, 0x63, 0x63, 0x63, 0x7f, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'A'
    {0x7e, 0x63, 0x63, 0x63, 0x7e, 0x63, 0x63, 0x63, 0x63, 0x63, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'B'
    {0x3e, 0x63, 0x63, 0x60, 0x60, 0x60, 0x60, 0x60, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'C'
    {0x7c, 0x66, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x66, 0x7c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'D'
    {0x7f, 0x60, 0x60, 0x60, 0x7e, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'E'
    {0x7f, 0x60, 0x60, 0x60, 0x7e, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'F'
    {0x3e, 0x63, 0x63, 0x60, 0x60, 0x6f, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'G'
    {0x63, 0x63, 0x63, 0x63, 0x7f, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'H'
    {0x3c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'I'
    {0x1f, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x6c, 0x6c, 0x38, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'J'
    {0x63, 0x63, 0x66, 0x6c, 0x78, 0x70, 0x78, 0x6c, 0x66, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'K'
    {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'L'
    {0x63, 0x77, 0x7f, 0x7f, 0x6b, 0x6b, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'M'
    {0x63, 0x63, 0x73, 0x7b, 0x7f, 0x6f, 0x67, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'N'
    {0x3e, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'O'
    {0x7e, 0x63, 0x63, 0x63, 0x7e, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'P'
    {0x3e, 0x63, 0x63, 0x63, 0x63, 0x63, 0x6b, 0x6f, 0x63, 0x63, 0x3d, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'Q'
    {0x7e, 0x63, 0x63, 0x63, 0x7e, 0x6c, 0x66, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'R'
    {0x3e, 0x63, 0x63, 0x30, 0x1c, 0x06, 0x03, 0x03, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'S'
    {0x7e, 0x5a, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'T'
    {0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'U'
    {0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x63, 0x36, 0x36, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'V'
    {0x63, 0x63, 0x63, 0x63, 0x63, 0x6b, 0x6b, 0x7f, 0x7f, 0x77, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'W'
    {0x63, 0x63, 0x36, 0x36, 0x1c, 0x1c, 0x1c, 0x36, 0x36, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'X'
    {0x63, 0x63, 0x63, 0x36, 0x36, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'Y'
    {0x7f, 0x63, 0x63, 0x06, 0x0c, 0x18, 0x30, 0x60, 0x63, 0x63, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'Z'
    {0x3c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // '['
    {0x00, 0xc0, 0xc0, 0x60, 0x30, 0x18, 0x0c, 0x06, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '\'
    {0x3c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // ']'
    {0x08, 0x1c, 0x36, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '^'
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff},  // '_'
    {0x30, 0x30, 0x18, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '`'
    {0x00, 0x00, 0x00, 0x00, 0x3c, 0x06, 0x06, 0x3e, 0x66, 0x66, 0x3b, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'a'
    {0x60, 0x60, 0x60, 0x60, 0x6e, 0x73, 0x63, 0x63, 0x63, 0x73, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'b'
    {0x00, 0x00, 0x00, 0x00, 0x3e, 0x63, 0x60, 0x60, 0x60, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'c'
    {0x03, 0x03, 0x03, 0x03, 0x3b, 0x67, 0x63, 0x63, 0x63, 0x67, 0x3b, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'd'
    {0x00, 0x00, 0x00, 0x00, 0x3e, 0x63, 0x63, 0x7f, 0x60, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'e'
    {0x0e, 0x1b, 0x33, 0x30, 0x30, 0x7c, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'f'
    {0x00, 0x00, 0x00, 0x00, 0x3b, 0x67, 0x63, 0x63, 0x63, 0x67, 0x3b, 0x03, 0x63, 0x63, 0x3e, 0x00},  // 'g'
    {0x60, 0x60, 0x60, 0x60, 0x6e, 0x73, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'h'
    {0x18, 0x18, 0x00, 0x00, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'i'
    {0x06, 0x06, 0x00, 0x00, 0x0e, 0x06, 0x06, 0x06, 0x06, 0x06, 0x66, 0x66, 0x66, 0x3c, 0x00, 0x00},  // 'j'
    {0x60, 0x60, 0x60, 0x60, 0x66, 0x6c, 0x78, 0x70, 0x78, 0x6c, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'k'
    {0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'l'
    {0x00, 0x00, 0x00, 0x00, 0x76, 0x7f, 0x6b, 0x6b, 0x6b, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'm'
    {0x00, 0x00, 0x00, 0x00, 0x6e, 0x73, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'n'
    {0x00, 0x00, 0x00, 0x00, 0x3e, 0x63, 0x63, 0x63, 0x63, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'o'
    {0x00, 0x00, 0x00, 0x00, 0x6e, 0x73, 0x63, 0x63, 0x63, 0x73, 0x6e, 0x60, 0x60, 0x60, 0x60, 0x00},  // 'p'
    {0x00, 0x00, 0x00, 0x00, 0x3b, 0x67, 0x63, 0x63, 0x63, 0x67, 0x3b, 0x03, 0x03, 0x03, 0x03, 0x00},  // 'q'
    {0x00, 0x00, 0x00, 0x00, 0x6e, 0x73, 0x63, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'r'
    {0x00, 0x00, 0x00, 0x00, 0x3e, 0x63, 0x60, 0x3e, 0x03, 0x63, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 's'
    {0x30, 0x30, 0x30, 0x30, 0x7c, 0x30, 0x30, 0x30, 0x30, 0x33, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00},  // 't'
    {0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x63, 0x67, 0x3b, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'u'
    {0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x36, 0x36, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'v'
    {0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x63, 0x6b, 0x6b, 0x7f, 0x36, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'w'
    {0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x36, 0x1c, 0x1c, 0x36, 0x63, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'x'
    {0x00, 0x00, 0x00, 0x00, 0x63, 0x63, 0x63, 0x67, 0x3b, 0x03, 0x03, 0x66, 0x66, 0x3c, 0x00, 0x00},  // 'y'
    {0x00, 0x00, 0x00, 0x00, 0x7f, 0x63, 0x06, 0x0c, 0x18, 0x33, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00},  // 'z'
    {0x0e, 0x18, 0x18, 0x18, 0x18, 0x70, 0x18, 0x18, 0x18, 0x18, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00},  // '{'
    {0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00},  // '|'
    {0x70, 0x18, 0x18, 0x18, 0x18, 0x0e, 0x18, 0x18, 0x18, 0x18, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00},  // '}'
    {0x31, 0x6b, 0x46, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // '~'
};

static uint32_t __attribute__((unused)) strlen_simple(const char* str) {
    uint32_t len = 0;
    while (str[len] != 0) {
        ++len;
    }
    return len;
}

void draw_pixel(uint32_t x, uint32_t y, Rgb color) {
    auto* mode = g_gop->Mode;
    if (!mode || !mode->Info) {
        return;
    }
    const uint32_t width = mode->Info->HorizontalResolution;
    const uint32_t height = mode->Info->VerticalResolution;
    if (x >= width || y >= height) {
        return;
    }

    const uint32_t index = y * mode->Info->PixelsPerScanLine + x;
    auto* fb = reinterpret_cast<uint8_t*>(mode->FrameBufferBase);
    const uint32_t offset = index * 4;
    // Assume BGRa ordering (PixelBlueGreenRedReserved8BitPerColor).
    fb[offset + 0] = color.b;
    fb[offset + 1] = color.g;
    fb[offset + 2] = color.r;
    fb[offset + 3] = 0;
}

void draw_char(char c, uint32_t x, uint32_t y, Rgb fg, Rgb bg) {
    if (c < 32 || c > 127) {
        return;
    }
    const uint8_t* glyph = kFont8x16[static_cast<uint32_t>(c) - 32];
    for (uint32_t row = 0; row < 16; ++row) {
        const uint8_t bits = glyph[row];
        for (uint32_t col = 0; col < 8; ++col) {
            const bool on = (bits >> (7 - col)) & 1;
            draw_pixel(x + col, y + row, on ? fg : bg);
        }
    }
}

}  // namespace

void renderer_init(EFI_GRAPHICS_OUTPUT_PROTOCOL* gop) { g_gop = gop; }

void renderer_clear(Rgb color) {
    auto* mode = g_gop->Mode;
    if (!mode || !mode->Info) {
        return;
    }
    for (uint32_t y = 0; y < mode->Info->VerticalResolution; ++y) {
        for (uint32_t x = 0; x < mode->Info->HorizontalResolution; ++x) {
            draw_pixel(x, y, color);
        }
    }
}

void renderer_rect(uint32_t x, uint32_t y, uint32_t w, uint32_t h, Rgb color) {
    auto* mode = g_gop->Mode;
    if (!mode || !mode->Info) {
        return;
    }
    const uint32_t screen_w = mode->Info->HorizontalResolution;
    const uint32_t screen_h = mode->Info->VerticalResolution;
    const uint32_t x_end = (x + w > screen_w) ? screen_w : (x + w);
    const uint32_t y_end = (y + h > screen_h) ? screen_h : (y + h);
    for (uint32_t yy = y; yy < y_end; ++yy) {
        for (uint32_t xx = x; xx < x_end; ++xx) {
            draw_pixel(xx, yy, color);
        }
    }
}

void renderer_rect_outline(uint32_t x, uint32_t y, uint32_t w, uint32_t h, Rgb color) {
    auto* mode = g_gop->Mode;
    if (!mode || !mode->Info || w == 0 || h == 0) {
        return;
    }
    const uint32_t screen_w = mode->Info->HorizontalResolution;
    const uint32_t screen_h = mode->Info->VerticalResolution;
    const uint32_t x_end = (x + w > screen_w) ? screen_w : (x + w);
    const uint32_t y_end = (y + h > screen_h) ? screen_h : (y + h);
    if (x >= x_end || y >= y_end) {
        return;
    }

    // Top and bottom edges
    for (uint32_t xx = x; xx < x_end; ++xx) {
        draw_pixel(xx, y, color);
        if (y_end - 1 != y) {
            draw_pixel(xx, y_end - 1, color);
        }
    }

    // Left and right edges
    for (uint32_t yy = y; yy < y_end; ++yy) {
        draw_pixel(x, yy, color);
        if (x_end - 1 != x) {
            draw_pixel(x_end - 1, yy, color);
        }
    }
}

void renderer_text(const char* text, uint32_t x, uint32_t y, Rgb fg, Rgb bg) {
    uint32_t cx = x;
    for (uint32_t i = 0; text[i] != 0; ++i) {
        draw_char(text[i], cx, y, fg, bg);
        cx += 8;
    }
}

uint32_t renderer_width() {
    return g_gop && g_gop->Mode && g_gop->Mode->Info ? g_gop->Mode->Info->HorizontalResolution : 0;
}

uint32_t renderer_height() {
    return g_gop && g_gop->Mode && g_gop->Mode->Info ? g_gop->Mode->Info->VerticalResolution : 0;
}
